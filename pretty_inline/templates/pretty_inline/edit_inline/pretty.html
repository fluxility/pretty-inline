{% load i18n admin_static admin_modify %}
<div class="inline-group" id="{{ inline_admin_formset.formset.prefix }}-group">
    <div class="tabular inline-related {% if forloop.last %}last-related{% endif %}">
        <fieldset class="module">
            <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>
        {{ inline_admin_formset.formset.management_form }}
        {{ inline_admin_formset.formset.non_form_errors }}
        <table>
            <thead>
            {% for field in inline_admin_formset.fields %}
                {% if not field.widget.is_hidden %}
                    <th{% if forloop.first %} colspan="2"{% endif %}{% if field.required %} class="required"{% endif %}>{{ field.label|capfirst }}</th>
                {% endif %}
            {% endfor %}
            <th>{% trans "Actions" %}</th>
            </thead>
            {% for inline_admin_form in inline_admin_formset %}
                <tbody id="{{ inline_admin_formset.formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}"
                        class="{% if forloop.last %} empty-form{% endif %}">
                <tr>
                    {% for fieldset in inline_admin_form %}
                        {% for line in fieldset %}
                            {% for field in line %}
                                {% if not field.field.is_hidden %}
                                    <td{% if field.field.name %} class="field-{{ field.field.name }}"{% endif %}{% if forloop.first %} colspan="2"{% endif %}>{{ field.field.contents }}</td>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                    <td class="actions">
                        {% if inline_admin_formset.formset.can_delete %}{% if inline_admin_form.original %}{{ inline_admin_form.deletion_field.field }}{% endif %}{% endif %}
                    </td>
                </tr>
                <tr class="form">{% spaceless %}
                    <td colspan="{{ inline_admin_form|cell_count }}">
                        {% if inline_admin_form.form.non_field_errors %}
                            {{ inline_admin_form.form.non_field_errors }}{% endif %}
                        {% for fieldset in inline_admin_form %}
                            {% include "admin/includes/fieldset.html" %}
                        {% endfor %}
                        {% if inline_admin_form.needs_explicit_pk_field %}
                            {{ inline_admin_form.pk_field.field }}{% endif %}
                        {{ inline_admin_form.fk_field.field }}
                        <button type="button" class="ok">{% trans "Ok" %}</button>
                    </td>
                {% endspaceless %}</tr>
                </tbody>
            {% endfor %}
        </table>
        </fieldset>
    </div>
</div>

<script type="text/javascript">
    (function ($) {
        $("#{{ inline_admin_formset.formset.prefix }}-group .inline-related tbody").prettyFormset({
            prefix: '{{ inline_admin_formset.formset.prefix }}',
            adminStaticPrefix: '{% static "admin/" %}',
            deleteText: "{% trans "Remove" %}",
            addText: "{% blocktrans with verbose_name=inline_admin_formset.opts.verbose_name|capfirst %}Add {{ verbose_name }}{% endblocktrans %}"
        });
    })(django.jQuery);
</script>
